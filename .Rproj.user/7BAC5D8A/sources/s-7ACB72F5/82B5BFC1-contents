# 3d coordinates

rm(list = ls())

library(data.table)
library(ggplot2)
library(POV)


nXStart = 0
nYStart = 0
nXEnd = 120
nYEnd = 80


mOrigin = cbind(
    60,
    30,
    40
)

mScreenCoordinate = cbind(
    70,
    35,
    0
)

mOrigin = cbind(
    60,
    200,
    40
)

mScreenCoordinate = cbind(
    60,
    42,
    0
)

mCoordinates = (cbind(
  x = seq(0,2*pi,0.01) * 60/pi,
  y = cos(seq(0,2*pi,0.01)) * 80,
  z = 0
))

qwe = fGetTransformedCoordinates(
    mCoordinates,
    mOrigin,
    mScreenCoordinate,
    bTreatAsClosedPolyon = 1
)

p1 = ggplot() + geom_pitch(
   nXStart = 0,
   nYStart = 0,
   nXEnd = 120,
   nYEnd = 80,
   cPitchColour = 'black', 
   mOrigin = mOrigin,
   mScreenCoordinate = mScreenCoordinate
) + 
   # theme_pitch() +
   theme(
      plot.background = element_rect( fill = '#444444' ),
      legend.position = 'none'
   )

vnAngles = seq(0,2*pi,0.01)
nRadius = 1
s0 = cbind(40, 10, 0)
u = cbind(10, 30, 10)
a = cbind(0, 0,-9.8)
t = abs(2 * u[,3] / a[,3])
t = seq(0, t, t/100)
mPassCoordinates1 = matrix(rep(s0, length(t)), ncol = 3, byrow = T) + ( t %*% u ) + ( 0.5 * ( t * t ) %*% a ) 
# plot((((mCoordinates[,1]^2)) + ((mCoordinates[,2]^2))^0.5) ^ 0.5 , mCoordinates[,3])

mPassTransformedCoordinates1 = fGetTransformedCoordinates(
    mPassCoordinates1,
    mOrigin,
    mScreenCoordinate,
    bTreatAsClosedPolyon = F
)

set.seed(1)
mRunCoordinates1 = cbind(
   matrix(rep(mPassCoordinates1[nrow(mPassCoordinates1), 1:2], 60), ncol = 2, byrow = T) + 
   cbind(
      cumsum(abs(rnorm(60))),
      -cumsum(abs(rnorm(60)))/2.5
   ),
   0
)

mRunTransformedCoordinates1 = fGetTransformedCoordinates(
    mRunCoordinates1,
    mOrigin,
    mScreenCoordinate,
    bTreatAsClosedPolyon = F
)

mTransformedCoordinatesGroundProjection = fGetTransformedCoordinates(
    cbind(mPassCoordinates1[,1], mPassCoordinates1[,2], 0),
    mOrigin,
    mScreenCoordinate,
    bTreatAsClosedPolyon = F
)

mStartPointProjection = fGetTransformedCoordinates(
    cbind(mPassCoordinates1[1,1] + (cos(vnAngles) * nRadius), mPassCoordinates1[1,2] + (sin(vnAngles) * nRadius), 0),
    mOrigin,
    mScreenCoordinate,
    bTreatAsClosedPolyon = T
)

mEndPointProjection = fGetTransformedCoordinates(
    cbind(mPassCoordinates1[nrow(mPassCoordinates1),1] + (cos(vnAngles) * nRadius), mPassCoordinates1[nrow(mPassCoordinates1),2] + (sin(vnAngles) * nRadius), 0),
    mOrigin,
    mScreenCoordinate,
    bTreatAsClosedPolyon = T
)

mRunPointProjection = fGetTransformedCoordinates(
    cbind(mRunCoordinates1[nrow(mRunCoordinates1),1] + (cos(vnAngles) * nRadius), mRunCoordinates1[nrow(mRunCoordinates1),2] + (sin(vnAngles) * nRadius), 0),
    mOrigin,
    mScreenCoordinate,
    bTreatAsClosedPolyon = T
)


s0 = mRunCoordinates1[nrow(mRunCoordinates1),]
u = cbind(10, -15, 0.8)
a = cbind(0, 6, 0)
t = (nXEnd - s0[1]) / u[,1]
t = seq(0, t, t/100)
mShotCoordinates1 = matrix(rep(s0, length(t)), ncol = 3, byrow = T) + ( t %*% u ) + ( 0.5 * ( t * t ) %*% a ) 

mShotCoordinates1Trajectory = fGetTransformedCoordinates(
    mShotCoordinates1,
    mOrigin,
    mScreenCoordinate,
    bTreatAsClosedPolyon = F
)

mShotCoordinates1Projection = fGetTransformedCoordinates(
    cbind(
       120, 
       mShotCoordinates1[nrow(mShotCoordinates1),2] + (sin(vnAngles) * nRadius), 
       mShotCoordinates1[nrow(mShotCoordinates1),3] + (cos(vnAngles) * nRadius)
    ),
    mOrigin,
    mScreenCoordinate,
    bTreatAsClosedPolyon = F
)

p1 + 
   geom_polygon(
      data = data.table(
         x = mStartPointProjection[,1],
         y = mStartPointProjection[,2]
      ),
      aes(
         x = x,
         y = y
      ),
      color = 'red',
      fill = 'red',
      alpha = 0.5
   ) + 
   geom_polygon(
      data = data.table(
         x = mEndPointProjection[,1],
         y = mEndPointProjection[,2]
      ),
      aes(
         x = x,
         y = y
      ),
      color = 'red',
      fill = 'red',
      alpha = 0.5
   ) + 
   geom_polygon(
      data = data.table(
         x = mShotCoordinates1Projection[,1],
         y = mShotCoordinates1Projection[,2]
      ),
      aes(
         x = x,
         y = y
      ),
      color = 'red',
      fill = 'red',
      alpha = 0.5
   ) + 
   geom_polygon(
      data = data.table(
         x = mRunPointProjection[,1],
         y = mRunPointProjection[,2]
      ),
      aes(
         x = x,
         y = y
      ),
      color = 'red',
      fill = 'red',
      alpha = 0.5
   ) + 
   geom_path(
      data = data.table(
         x = mPassTransformedCoordinates1[,1],
         y = mPassTransformedCoordinates1[,2],
         group = mPassTransformedCoordinates1[,3]
      ),
      aes(
         x = x,
         y = y,
         group = group
      ),
      color = 'red'
   ) + 
   geom_path(
      data = data.table(
         x = mTransformedCoordinatesGroundProjection[,1],
         y = mTransformedCoordinatesGroundProjection[,2],
         group = mTransformedCoordinatesGroundProjection[,3]
      ),
      aes(
         x = x,
         y = y,
         group = group
      ),
      color = 'red',
      linetype = 2
   ) + 
   geom_path(
      data = data.table(
         x = mRunTransformedCoordinates1[,1],
         y = mRunTransformedCoordinates1[,2],
         group = mRunTransformedCoordinates1[,3]
      ),
      aes(
         x = x,
         y = y,
         group = group
      ),
      color = 'red'
   ) + 
   geom_path(
      data = data.table(
         x = mShotCoordinates1Trajectory[,1],
         y = mShotCoordinates1Trajectory[,2],
         group = mShotCoordinates1Trajectory[,3]
      ),
      aes(
         x = x,
         y = y,
         group = group
      ),
      color = 'red'
   )
   
